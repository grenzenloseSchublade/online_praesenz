<!-- Interaktiver Mandelbrot-Julia-Explorer -->
<!-- noUiSlider CDN -->
<link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css" rel="stylesheet" integrity="sha384-PSZaVsyG9jDu8hFaSJev5s/9poIJlX7cuxSGdqCgXRHpo2DzIaZAyCd2rG/DJJmV" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js" integrity="sha384-/gBUOLHADjY2rp6bHB0IyW9AC28q4OsnirJScje4l1crgYW7Qarx3dH8zcqcUgmy" crossorigin="anonymous"></script>
<!-- Tom Select CDN -->
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.4.1/dist/css/tom-select.css" rel="stylesheet" integrity="sha384-ny89R1e2Q335kISzsNGnOmYXcpZzyhDAQHA4nPPBPWSlNj9MWD5KQLMtuGTX4z0X" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.4.1/dist/js/tom-select.complete.min.js" integrity="sha384-U3YO9KA9gHoGO+Y5cTqEtWp5gy6hbXb3vfj0lvl+Zvt7OJLKVPf+5enfdivNC0td" crossorigin="anonymous"></script>

<div class="explorer-container focus-mode" id="explorer-container">
  <h2 class="explorer-main-title">Interaktiver Mandelbrot-Julia-Explorer</h2>
  <div class="explorer-toolbar">
    <button id="explorerFocusMode" class="toggle-button active" title="Fokusmodus" aria-label="Fokusmodus" aria-pressed="true">
      <span class="icon"><i class="fas fa-crosshairs" aria-hidden="true"></i></span>
      <span class="btn-text">Fokus</span>
    </button>
    <button id="resetExplorer" class="toggle-button" title="Zurücksetzen" aria-label="Zurücksetzen">
      <span class="icon"><i class="fas fa-undo" aria-hidden="true"></i></span>
      <span class="btn-text">Reset</span>
    </button>
    <button id="explorerFullscreen" class="toggle-button" title="Vollbild" aria-label="Vollbild">
      <span class="icon"><i class="fas fa-expand" aria-hidden="true"></i></span>
      <span class="btn-text">Vollbild</span>
    </button>
  </div>
  <div class="explorer-controls">
    <div class="controls-basic">
      <div class="control-row">
        <label for="explorerMaxIter">Iterationen:</label>
        <div id="explorerMaxIterSlider" class="nouislider-wrapper"></div>
        <span id="explorerIterValue" class="value-chip">80</span>
      </div>
      <div class="color-controls-row">
        <div class="color-control-item">
          <label for="explorerColorScheme">Farben:</label>
          <select id="explorerColorScheme">
            <option value="blau-rot">Blau-Rot</option>
            <option value="cyberpunk">Cyberpunk</option>
            <option value="retrowave" selected>Retrowave</option>
            <option value="feuer">Feuer</option>
            <option value="ozean">Ozean</option>
            <option value="monochrom">Monochrom</option>
            <option value="regenbogen">Regenbogen</option>
            <option value="ultraviolett">Ultraviolett</option>
            <option value="goldgrün">Gold-Grün</option>
          </select>
        </div>
      </div>
      <!-- Erweitert-Button am Ende der Basic Controls -->
      <div class="advanced-toggle-row">
        <button id="explorerAdvancedToggle" class="toggle-button expand-toggle" title="Erweiterte Optionen anzeigen" aria-label="Erweiterte Optionen" aria-expanded="false">
          <span class="icon"><i class="fas fa-sliders-h" aria-hidden="true"></i></span>
          <span class="btn-text">Erweiterte Optionen</span>
          <span class="chevron"><i class="fas fa-chevron-down" aria-hidden="true"></i></span>
        </button>
      </div>
    </div>
    <div class="controls-advanced">
      <div class="color-controls-row">
        <div class="color-control-item">
          <label for="explorerColorIntensity">Intensität:</label>
          <button id="explorerColorIntensity" class="toggle-button" title="Farbintensität" aria-label="Farbintensität">
            <span class="icon"><i class="fas fa-adjust" aria-hidden="true"></i></span>
            <span class="btn-text">Subtil</span>
          </button>
        </div>
        <div class="color-control-item">
          <label for="explorerAllowExtremeZoom">Extremzoom:</label>
          <button id="explorerAllowExtremeZoom" class="toggle-button" title="Extremzoom erlauben" aria-label="Extremzoom erlauben">
            <span class="icon"><i class="fas fa-bolt" aria-hidden="true"></i></span>
            <span class="btn-text">Aus</span>
          </button>
        </div>
      </div>
      <div class="button-row">
        <button id="saveExplorerImage" title="Bild speichern" aria-label="Bild speichern">
          <span class="icon"><i class="fas fa-download" aria-hidden="true"></i></span>
          <span class="btn-text">Export</span>
        </button>
      </div>
    </div>
  </div>
  
  <div class="explorer-row">
    <div class="explorer-column">
      <h3 class="explorer-title">Mandelbrot-Menge</h3>
      <div class="canvas-container">
        <canvas id="mandelbrotCanvas" width="800" height="450"></canvas>
        <div class="loading-indicator" id="mandelbrotLoading">Berechne...</div>
        <div class="zoom-warning" id="mandelbrotZoomWarning">Extremzoom aktiv – Details koennen instabil sein.</div>
        
        <!-- Seitlicher Zoom-Regler für Smartphones -->
        <div class="mobile-zoom-control" id="mandelbrotMobileZoom">
          <div class="zoom-buttons-container">
            <button class="zoom-button zoom-in" id="mandelbrotZoomIn" aria-label="Mandelbrot vergrößern">+</button>
            <div class="zoom-level-display" id="mandelbrotZoomLevel">1.00×</div>
            <button class="zoom-button zoom-out" id="mandelbrotZoomOut" aria-label="Mandelbrot verkleinern">−</button>
          </div>
        </div>
      </div>
      <div class="info-panel">
        <p>Klicken Sie auf einen Punkt, um die entsprechende Julia-Menge zu sehen.</p>
      </div>
    </div>
    <div class="explorer-column">
      <h3 class="explorer-title">Julia-Menge für c = <span id="juliaParameter" class="info-value">-0.7 + 0.27i</span></h3>
      <div class="canvas-container">
        <canvas id="explorerJuliaCanvas" width="800" height="450"></canvas>
        <div class="loading-indicator" id="juliaLoading">Berechne...</div>
        <div class="zoom-warning" id="explorerJuliaZoomWarning">Extremzoom aktiv – Details koennen instabil sein.</div>
        
        <!-- Seitlicher Zoom-Regler für Smartphones -->
        <div class="mobile-zoom-control" id="juliaMobileZoom">
          <div class="zoom-buttons-container">
            <button class="zoom-button zoom-in" id="juliaZoomIn" aria-label="Julia vergrößern">+</button>
            <div class="zoom-level-display" id="juliaZoomLevel">1.00×</div>
            <button class="zoom-button zoom-out" id="juliaZoomOut" aria-label="Julia verkleinern">−</button>
          </div>
        </div>
      </div>
      <div class="info-panel">
        <p>Die Julia-Menge für den gewählten Parameter c.</p>
      </div>
    </div>
  </div>
  
  <!-- Erklärungsbereich -->
  <div class="explorer-explanation-container">
    <button id="explorerToggleExplanation" class="explorer-explanation-toggle" aria-label="Erklärung ein-/ausblenden" aria-expanded="false">
      Erklärung anzeigen <span class="toggle-icon">▼</span>
    </button>
    <div id="explorerExplanationBox" class="explorer-explanation-box">
      <h3>Mandelbrot-Julia-Explorer</h3>
      <p>Dieser Explorer zeigt die faszinierende Verbindung zwischen der Mandelbrot-Menge und den Julia-Mengen. Jeder Punkt <code>c</code> in der Mandelbrot-Menge erzeugt eine einzigartige Julia-Menge.</p>
      
      <section class="explanation-section">
        <h4>Die Verbindung</h4>
        <ul>
          <li><strong>Innerhalb der Mandelbrot-Menge</strong> — Zusammenhängende Julia-Mengen mit komplexen Strukturen</li>
          <li><strong>Am Rand</strong> — Die interessantesten, oft fraktalen Julia-Mengen</li>
          <li><strong>Außerhalb</strong> — Fragmentierte „Staub"-Strukturen</li>
        </ul>
        <p class="hint">Die schönsten Julia-Mengen entstehen am Rand – probieren Sie die „Antennen" und „Knospen"!</p>
      </section>
      
      <section class="explanation-section">
        <h4>Navigation</h4>
        <div class="nav-columns">
          <div class="nav-column">
            <h5>Desktop</h5>
            <ul>
              <li><strong>Linksklick (Mandelbrot)</strong> — Wählt c-Parameter</li>
              <li><strong>Mausrad</strong> — Zoom an Position</li>
              <li><strong>Linksklick + Ziehen</strong> — Rechteck-Zoom</li>
              <li><strong>Rechtsklick + Ziehen</strong> — Verschieben</li>
              <li><strong>Doppelklick</strong> — Herauszoomen</li>
            </ul>
          </div>
          <div class="nav-column">
            <h5>Touch</h5>
            <ul>
              <li><strong>Tippen (Mandelbrot)</strong> — Wählt c-Parameter</li>
              <li><strong>Pinch</strong> — Zoom hinein/heraus</li>
              <li><strong>1-Finger-Ziehen</strong> — Verschieben</li>
              <li><strong>+/− Buttons</strong> — Zoom-Steuerung</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<style>
  .explorer-container {
    display: flex;
    flex-direction: column;
    max-width: 100%;
    margin: 0 auto 20px;
    background: #222;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    width: 100%;
    box-sizing: border-box;
  }
  
  .explorer-main-title {
    color: #eacfb4;
    margin: 0 0 15px 0;
    padding: 5px 0;
    text-align: center;
    font-size: 24px;
    font-weight: 600;
    border-bottom: 2px solid #444;
    position: relative;
  }
  
  .explorer-main-title::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 180px;
    height: 2px;
    background-color: #0066cc;
  }
  
  /* ========================================
     Explorer Controls Panel - Modern Compact Design
     ======================================== */
  .explorer-controls {
    margin-bottom: 15px;
    padding: 16px;
    background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .explorer-toolbar {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
    margin-bottom: 12px;
    justify-content: space-between;
  }

  .explorer-toolbar .toggle-button {
    flex: 1;
    min-width: 0;
    max-width: 140px;
  }

  .explorer-toolbar .icon {
    /* margin wird durch gap im parent gesteuert */
    margin: 0;
  }

  /* ========================================
     Expand Toggle Button (Erweitert)
     ======================================== */
  .advanced-toggle-row {
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }
  
  .expand-toggle {
    width: 100%;
    justify-content: center;
    gap: 8px;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px dashed rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    color: rgba(255, 255, 255, 0.6);
    font-size: 13px;
    transition: all 0.25s ease;
  }
  
  .expand-toggle:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(5, 217, 232, 0.3);
    color: rgba(255, 255, 255, 0.9);
  }
  
  .expand-toggle .chevron {
    display: flex;
    align-items: center;
    margin-left: auto;
    transition: transform 0.3s ease;
  }
  
  .expand-toggle .chevron i {
    font-size: 12px;
  }
  
  /* Active state when panel is open */
  .explorer-container.advanced-open .expand-toggle {
    background: rgba(5, 217, 232, 0.1);
    border-color: rgba(5, 217, 232, 0.3);
    border-style: solid;
    color: #05d9e8;
    -webkit-box-shadow: 0 0 8px 2px rgba(5, 217, 232, 0.2);
    box-shadow: 0 0 8px 2px rgba(5, 217, 232, 0.2);
  }
  
  .explorer-container.advanced-open .expand-toggle .chevron {
    transform: rotate(180deg);
  }

  .btn-text {
    white-space: nowrap;
  }

  .controls-basic,
  .controls-advanced {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .controls-advanced {
    display: none;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid rgba(5, 217, 232, 0.2);
  }

  .explorer-container.advanced-open .controls-advanced {
    display: flex;
  }

  .explorer-container.advanced-open .info-panel {
    display: block;
  }

  .explorer-container.focus-mode {
    padding: 10px;
  }

  .explorer-container.focus-mode .explorer-controls,
  .explorer-container.focus-mode .info-panel {
    display: none;
  }

  .explorer-container.focus-mode .explorer-row {
    gap: 10px;
  }

  .explorer-container.fullscreen-mode {
    position: relative;
  }

  .explorer-container.fullscreen-mode,
  .explorer-container.fullscreen-mode .canvas-container {
    width: 100vw;
    max-width: 100vw;
  }

  .explorer-container.fullscreen-mode .canvas-container {
    height: calc(100vh - 24px);
  }

  .explorer-container.fullscreen-mode #mandelbrotCanvas,
  .explorer-container.fullscreen-mode #explorerJuliaCanvas {
    max-height: 100vh;
    min-height: auto;
  }

  .explorer-container.fullscreen-mode .explorer-toolbar,
  .explorer-container.fullscreen-mode .explorer-controls {
    position: absolute;
    left: 12px;
    right: 12px;
    z-index: 200;
    background: rgba(34, 34, 34, 0.9);
    backdrop-filter: blur(6px);
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
  }

  .explorer-container.fullscreen-mode .explorer-toolbar {
    top: 12px;
  }

  .explorer-container.fullscreen-mode .explorer-controls {
    top: 64px;
    max-height: 55vh;
    overflow: auto;
  }


  @media (max-width: 768px) {
    .explorer-toolbar {
      gap: 6px;
    }
    .explorer-toolbar .toggle-button {
      padding: 8px 10px;
    }
  }

  @media (max-width: 480px) {
    .explorer-toolbar .btn-text {
      display: none;
    }
    .explorer-toolbar .icon {
      margin-right: 0;
    }
    .explorer-toolbar .toggle-button {
      padding: 10px 12px;
    }
  }
  
  /* ========================================
     Control Rows - Compact Inline Layout
     ======================================== */
  .control-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.04);
    transition: background 0.2s ease;
  }
  
  .control-row:hover {
    background: rgba(255, 255, 255, 0.05);
  }

  .control-row label {
    flex-shrink: 0;
    min-width: 70px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 13px;
    font-weight: 500;
    text-align: left;
  }

  /* ========================================
     Color Controls - Two Column Layout
     ======================================== */
  .color-controls-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 10px;
  }

  .color-control-item {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.04);
    transition: background 0.2s ease;
  }
  
  .color-control-item:hover {
    background: rgba(255, 255, 255, 0.05);
  }

  .color-control-item label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .color-control-item select,
  .color-control-item button {
    width: 100%;
  }

  /* ========================================
     Button Row - Clean Action Area
     ======================================== */
  .button-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding-top: 14px;
    margin-top: 4px;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }
  
  /* ========================================
     Mobile Responsive - Controls Panel
     ======================================== */
  @media (max-width: 768px) {
    .explorer-container {
      padding: 10px;
      width: 100%;
      max-width: 100%;
      margin-left: 0;
      margin-right: 0;
      border-radius: 0;
      box-sizing: border-box;
    }
    
    .explorer-controls {
      padding: 14px;
    }
    
    .control-row {
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .control-row label {
      width: 100%;
      min-width: unset;
      margin-bottom: 2px;
    }
    
    .nouislider-wrapper {
      flex: 1 1 100%;
      margin: 0;
      order: 1;
    }
    
    .control-row .value-chip {
      order: 2;
      margin-left: auto;
    }
    
    .color-controls-row {
      grid-template-columns: 1fr;
    }

    .explorer-column {
      min-width: 100%;
      flex: 1 1 100%;
    }

  }
  
  .explorer-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
  }
  
  .explorer-column {
    flex: 1 1 300px;
    min-width: 260px;
  }
  
  .explorer-title {
    color: #eacfb4;
    margin: 0 0 20px 0;
    padding: 10px 0;
    text-align: center;
    font-size: 20px;
    font-weight: 600;
    border-bottom: 2px solid #444;
    position: relative;
  }
  
  .explorer-title::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 2px;
    background-color: #0066cc;
  }
  
  .canvas-container {
    position: relative;
    width: 100%;
    border-radius: 4px;
    overflow: hidden;
    margin: 0 auto;
  }
  
  #mandelbrotCanvas, #explorerJuliaCanvas {
    display: block;
    width: 100%;
    height: auto;
    border-radius: 4px;
    cursor: crosshair;
    max-height: 60vh;
    aspect-ratio: 16/9;
    min-height: 240px;
    touch-action: none;
  }

  .zoom-box {
    position: absolute;
    border: 2px dashed #ff00ff;
    background: rgba(255, 0, 255, 0.15);
    pointer-events: none;
    display: none;
    box-sizing: border-box;
    z-index: 5;
  }

  .zoom-warning {
    position: absolute;
    left: 12px;
    bottom: 12px;
    background: rgba(0, 0, 0, 0.75);
    color: #ffd1d1;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    display: none;
    z-index: 6;
  }

  @media (max-width: 768px) {
    #mandelbrotCanvas, #explorerJuliaCanvas {
      max-height: 55vh;
      min-height: 180px;
    }
  }
  
  .loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    display: none;
  }
  
  .info-panel {
    margin-top: 10px;
    background: #333;
    padding: 12px 15px;
    border-radius: 4px;
    color: #ddd;
    font-size: 16px;
    line-height: 1.5;
    text-align: left;
    display: none;
  }
  
  .info-panel p {
    margin: 5px 0;
  }
  
  .info-value {
    font-weight: bold;
    color: #fff;
    font-size: 16px;
  }

  /* ========================================
     Value Chip - Compact Display
     ======================================== */
  .value-chip {
    flex-shrink: 0;
    min-width: 52px;
    padding: 5px 10px;
    color: #05d9e8;
    font-size: 13px;
    font-weight: 600;
    font-family: 'SF Mono', 'Consolas', monospace;
    text-align: center;
    border-radius: 8px;
    background: rgba(5, 217, 232, 0.1);
    border: 1px solid rgba(5, 217, 232, 0.2);
  }
  
  /* ========================================
     General Button Styling
     ======================================== */
  .explorer-container button {
    background: rgba(255, 255, 255, 0.04);
    color: #eacfb4;
    border: 1px solid rgba(255, 255, 255, 0.08);
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    min-height: 40px; /* Touch-friendly */
  }

  .explorer-container button:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(5, 217, 232, 0.3);
    transform: translateY(-1px);
  }

  .explorer-container button:active {
    transform: scale(0.98) translateY(0);
  }

  .explorer-container button:focus-visible {
    background: rgba(5, 217, 232, 0.1);
    border-color: rgba(5, 217, 232, 0.5);
    box-shadow: 0 0 0 3px rgba(5, 217, 232, 0.15);
    outline: none;
  }
  
  /* ========================================
     Tom Select - Custom Dark Theme
     ======================================== */
  .explorer-controls .ts-wrapper {
    width: 100%;
  }
  
  .explorer-controls .ts-wrapper.single .ts-control {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 8px 14px;
    min-height: 40px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: none;
  }
  
  .explorer-controls .ts-wrapper.single .ts-control:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(5, 217, 232, 0.3);
  }
  
  .explorer-controls .ts-wrapper.single.focus .ts-control {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(5, 217, 232, 0.5);
    box-shadow: 0 0 0 3px rgba(5, 217, 232, 0.15);
  }
  
  .explorer-controls .ts-control,
  .explorer-controls .ts-control input {
    color: #fff;
    font-size: 13px;
  }
  
  .explorer-controls .ts-control input::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }
  
  /* Dropdown Arrow */
  .explorer-controls .ts-wrapper.single .ts-control::after {
    border-color: rgba(255, 255, 255, 0.5) transparent transparent transparent;
    margin-top: -2px;
  }
  
  .explorer-controls .ts-wrapper.single.dropdown-active .ts-control::after {
    border-color: transparent transparent #05d9e8 transparent;
  }
  
  /* Dropdown Menu */
  .explorer-controls .ts-dropdown {
    background: #1e1e1e;
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    margin-top: 4px;
    overflow: hidden;
  }
  
  .explorer-controls .ts-dropdown .ts-dropdown-content {
    padding: 6px;
    max-height: 250px;
  }
  
  .explorer-controls .ts-dropdown .option {
    padding: 10px 14px;
    color: rgba(255, 255, 255, 0.8);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.15s ease;
    font-size: 13px;
  }
  
  .explorer-controls .ts-dropdown .option:hover,
  .explorer-controls .ts-dropdown .option.active {
    background: rgba(5, 217, 232, 0.15);
    color: #fff;
  }
  
  .explorer-controls .ts-dropdown .option.selected {
    background: rgba(5, 217, 232, 0.25);
    color: #05d9e8;
  }
  
  /* Hide native select (fallback) */
  .explorer-controls select.tomselected {
    display: none !important;
  }
  
  @media (max-width: 480px) {
    .explorer-controls {
      padding: 12px;
      border-radius: 10px;
    }
    
    .control-row,
    .color-control-item {
      padding: 8px 10px;
    }
    
    .control-row label,
    .color-control-item label {
      font-size: 12px;
    }
    
    .button-row {
      gap: 6px;
    }
    
    .explorer-container button {
      padding: 8px 12px;
      font-size: 12px;
      flex: 1;
      min-width: 0;
    }
  }
  
  /* ========================================
     noUiSlider Custom Styles
     ======================================== */
  .nouislider-wrapper {
    flex: 1;
    margin: 0 8px;
    min-width: 100px;
  }
  
  .nouislider-wrapper .noUi-target {
    background: rgba(255, 255, 255, 0.16);
    border: none;
    border-radius: 999px;
    box-shadow: none;
    height: 6px;
  }
  
  .nouislider-wrapper .noUi-connect {
    background: linear-gradient(90deg, #05d9e8, #4aa3ff);
    border-radius: 999px;
  }
  
  .nouislider-wrapper .noUi-handle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #4aa3ff;
    border: 2px solid rgba(0, 0, 0, 0.25);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    cursor: pointer;
    top: -8px;
    right: -10px;
  }
  
  .nouislider-wrapper .noUi-handle::before,
  .nouislider-wrapper .noUi-handle::after {
    display: none;
  }
  
  .nouislider-wrapper .noUi-handle:hover {
    background: #5cb8ff;
    transform: scale(1.1);
  }
  
  .nouislider-wrapper .noUi-handle:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 163, 255, 0.4), 0 2px 6px rgba(0, 0, 0, 0.4);
  }
  
  /* Mobile: Größerer Slider für Touch */
  @media (max-width: 768px) {
    .nouislider-wrapper .noUi-target {
      height: 8px;
    }
    
    .nouislider-wrapper .noUi-handle {
      width: 28px;
      height: 28px;
      top: -10px;
      right: -14px;
    }
  }
  
  select,
  option,
  optgroup {
    background: rgba(255, 255, 255, 0.06);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.12);
    padding: 8px 12px;
    border-radius: 999px;
    font-family: inherit;
    font-size: 14px;
    line-height: 1.2;
  }
  
  /* Toggle-Button Styling */
  .toggle-button {
    background: rgba(255, 255, 255, 0.04);
    color: #ddd;
    border: 1px solid rgba(255, 255, 255, 0.12);
    padding: 8px 12px;
    border-radius: 999px;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 80px;
    /* Flexbox für korrekte Icon-Zentrierung */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }
  
  .toggle-button .icon {
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }
  
  .toggle-button.active {
    background: rgba(5, 217, 232, 0.3) !important;
    color: #fff !important;
    border-color: rgba(5, 217, 232, 0.6) !important;
    /* Verstärkter Glow für Safari/iOS Kompatibilität */
    -webkit-box-shadow: 0 0 8px 2px rgba(5, 217, 232, 0.6), inset 0 0 4px rgba(5, 217, 232, 0.2);
    box-shadow: 0 0 8px 2px rgba(5, 217, 232, 0.6), inset 0 0 4px rgba(5, 217, 232, 0.2);
  }
  
  /* Seitlicher Zoom-Regler für Smartphones */
  .mobile-zoom-control {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    display: none; /* Standardmäßig ausgeblendet, wird per JavaScript für Mobilgeräte aktiviert */
    flex-direction: column;
    align-items: center;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
    padding: 5px 3px;
    z-index: 10;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }
  
  @media (max-width: 768px) {
    .mobile-zoom-control {
      right: 8px;
      top: auto;
      bottom: 10px;
      transform: none;
      padding: 6px 8px;
      background: rgba(0, 0, 0, 0.45);
      border-radius: 14px;
    }
    
    .zoom-button {
      width: 28px;
      height: 28px;
      font-size: 16px;
    }
    
    .zoom-level-display {
      font-size: 12px;
      padding: 2px 6px;
      margin: 0 2px;
    }
  }
  
  .zoom-buttons-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  @media (max-width: 768px) {
    .zoom-buttons-container {
      flex-direction: row;
      gap: 6px;
    }
  }
  
  .zoom-button {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: #444;
    color: white;
    font-size: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    padding: 0;
    line-height: 1;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    border: none;
    transition: background-color 0.2s, transform 0.1s;
  }
  
  .zoom-button:hover {
    background: #555;
  }
  
  .zoom-button:active {
    transform: scale(0.92);
    box-shadow: 0 0 1px rgba(0, 0, 0, 0.2);
  }
  
  .zoom-level-display {
    color: white;
    font-size: 12px;
    background: rgba(0, 0, 0, 0.25);
    padding: 1px 5px;
    border-radius: 6px;
    text-align: center;
    margin: 3px 0;
    min-width: 40px;
  }
  
  /* ========================================
     Explorer Explanation Box
     ======================================== */
  .explorer-explanation-container {
    margin-top: 20px;
    display: block;
  }
  
  .explorer-explanation-toggle {
    width: 100%;
    text-align: center;
    margin-bottom: 0;
    background: linear-gradient(145deg, rgba(42, 42, 42, 0.95), rgba(30, 30, 30, 0.98));
    color: #05d9e8;
    padding: 12px 16px;
    border: 1px solid rgba(5, 217, 232, 0.3);
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  .explorer-explanation-toggle:hover {
    background: linear-gradient(145deg, rgba(50, 50, 50, 0.95), rgba(35, 35, 35, 0.98));
    border-color: rgba(5, 217, 232, 0.5);
    box-shadow: 0 0 15px rgba(5, 217, 232, 0.2);
  }
  
  .explorer-explanation-toggle.active {
    background: linear-gradient(145deg, rgba(5, 217, 232, 0.15), rgba(5, 217, 232, 0.08));
    border-color: rgba(5, 217, 232, 0.5);
  }
  
  .explorer-explanation-toggle .toggle-icon {
    font-size: 10px;
    transition: transform 0.3s ease;
  }
  
  .explorer-explanation-toggle.active .toggle-icon {
    transform: rotate(180deg);
  }
  
  .explorer-explanation-box {
    background: linear-gradient(145deg, rgba(42, 42, 42, 0.95), rgba(30, 30, 30, 0.98));
    border: 1px solid rgba(5, 217, 232, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-top: 12px;
    color: #e0e0e0;
    font-size: 14px;
    line-height: 1.6;
    display: none;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  
  .explorer-explanation-box.visible {
    display: block;
  }
  
  .explorer-explanation-box h3 {
    margin: 0 0 16px 0;
    color: #ff00ff;
    font-size: 1.25rem;
    font-weight: 600;
    border-bottom: 2px solid rgba(255, 0, 255, 0.5);
    padding-bottom: 12px;
  }
  
  .explorer-explanation-box h4 {
    margin: 0;
    color: #05d9e8;
    font-size: 1rem;
    font-weight: 600;
    border-bottom: 1px solid rgba(5, 217, 232, 0.3);
    padding-bottom: 8px;
    margin-bottom: 12px;
  }
  
  .explorer-explanation-box h5 {
    margin: 0 0 6px 0;
    color: #d1f7ff;
    font-size: 0.875rem;
    font-weight: 500;
  }
  
  .explorer-explanation-box .explanation-section {
    margin-bottom: 20px;
  }
  
  .explorer-explanation-box .explanation-section:last-child {
    margin-bottom: 0;
  }
  
  .explorer-explanation-box p {
    margin: 0 0 10px 0;
  }
  
  .explorer-explanation-box p.hint {
    font-style: italic;
    color: #a0a0a0;
    font-size: 0.85rem;
  }
  
  .explorer-explanation-box code {
    background: rgba(5, 217, 232, 0.1);
    color: #05d9e8;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
  }
  
  .explorer-explanation-box ul {
    margin: 8px 0;
    padding-left: 0;
    list-style: none;
  }
  
  .explorer-explanation-box li {
    position: relative;
    padding-left: 16px;
    margin-bottom: 6px;
  }
  
  .explorer-explanation-box li::before {
    content: '›';
    position: absolute;
    left: 0;
    color: #05d9e8;
    font-weight: bold;
  }
  
  .explorer-explanation-box strong {
    color: #05d9e8;
  }
  
  .explorer-explanation-box .nav-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-top: 12px;
  }
  
  @media (max-width: 500px) {
    .explorer-explanation-box .nav-columns {
      grid-template-columns: 1fr;
    }
  }
  
  .explorer-explanation-box .nav-column h5 {
    margin-bottom: 8px;
    color: #ff00ff;
  }
</style>

<script src="{{ site.baseurl }}/assets/js/fractal-renderer.js"></script>
<script>
window.__fractalNewExplorer = true;

// Explorer Erklärbox-Funktionalität
function toggleExplorerExplanation() {
  const button = document.getElementById('explorerToggleExplanation');
  const explanationBox = document.getElementById('explorerExplanationBox');
  if (!explanationBox || !button) return;
  
  const isOpen = explanationBox.classList.contains('visible');
  
  if (isOpen) {
    explanationBox.classList.remove('visible');
    button.classList.remove('active');
    button.innerHTML = 'Erklärung anzeigen <span class="toggle-icon">▼</span>';
  } else {
    explanationBox.classList.add('visible');
    button.classList.add('active');
    button.innerHTML = 'Erklärung ausblenden <span class="toggle-icon">▲</span>';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Explanation toggle event listener
  const explorerToggleBtn = document.getElementById('explorerToggleExplanation');
  if (explorerToggleBtn) {
    explorerToggleBtn.addEventListener('click', toggleExplorerExplanation);
  }
  
  const container = document.querySelector('.explorer-container');
  const mandelbrotCanvas = document.getElementById('mandelbrotCanvas');
  const mandelbrotLoading = document.getElementById('mandelbrotLoading');
  const juliaCanvas = document.getElementById('explorerJuliaCanvas');
  const juliaLoading = document.getElementById('juliaLoading');

  // noUiSlider Setup
  const maxIterSliderElement = document.getElementById('explorerMaxIterSlider');
  const iterValueSpan = document.getElementById('explorerIterValue');
  
  noUiSlider.create(maxIterSliderElement, {
    start: 80,
    connect: [true, false],
    step: 10,
    range: {
      'min': 10,
      'max': 500
    },
    format: {
      to: value => Math.round(value),
      from: value => Number(value)
    }
  });
  
  // Tom Select für Farbschema-Dropdown initialisieren
  const colorSchemeSelect = document.getElementById('explorerColorScheme');
  let colorSchemeTomSelect = null;
  if (colorSchemeSelect && typeof TomSelect !== 'undefined') {
    colorSchemeTomSelect = new TomSelect('#explorerColorScheme', {
      create: false,
      sortField: null, // Reihenfolge beibehalten
      controlInput: null, // Kein Suchfeld
      allowEmptyOption: false
    });
  }
  
  const colorIntensityButton = document.getElementById('explorerColorIntensity');
  const allowExtremeZoomButton = document.getElementById('explorerAllowExtremeZoom');
  const resetButton = document.getElementById('resetExplorer');
  const saveImageButton = document.getElementById('saveExplorerImage');
  const juliaParamSpan = document.getElementById('juliaParameter');

  const advancedToggleButton = document.getElementById('explorerAdvancedToggle');
  const focusModeButton = document.getElementById('explorerFocusMode');
  const fullscreenButton = document.getElementById('explorerFullscreen');

  const mandelbrotZoomIn = container.querySelector('#mandelbrotZoomIn');
  const mandelbrotZoomOut = container.querySelector('#mandelbrotZoomOut');
  const mandelbrotZoomLevel = container.querySelector('#mandelbrotZoomLevel');
  const juliaZoomIn = container.querySelector('#juliaZoomIn');
  const juliaZoomOut = container.querySelector('#juliaZoomOut');
  const juliaZoomLevel = container.querySelector('#juliaZoomLevel');
  const mandelbrotMobileZoom = container.querySelector('#mandelbrotMobileZoom');
  const juliaMobileZoom = container.querySelector('#juliaMobileZoom');
  const mandelbrotZoomWarning = document.getElementById('mandelbrotZoomWarning');
  const explorerJuliaZoomWarning = document.getElementById('explorerJuliaZoomWarning');

  const state = {
    maxIterations: 80, // Startwert für noUiSlider
    colorScheme: colorSchemeSelect.value,
    useIntense: false,
    allowExtremeZoom: false,
    mandelbrot: { viewX: -0.5, viewY: 0, zoomLevel: 1 },
    julia: { viewX: 0, viewY: 0, zoomLevel: 1, realPart: -0.7, imagPart: 0.27015 }
  };

  const MIN_ZOOM = 0.5;
  const MAX_ZOOM_DEFAULT = 5000;
  const MAX_ZOOM_EXTREME = 500000;
  const ZOOM_WARNING_THRESHOLD = 100000;

  const mandelbrotRenderer = new FractalRenderer({
    canvas: mandelbrotCanvas,
    loadingIndicator: mandelbrotLoading,
    workerUrl: '{{ site.baseurl }}/assets/js/mandelbrot-worker.js',
    type: 'mandelbrot',
    allowIterationData: false,
    maxWorkers: FractalUtils.isMobileDevice() ? 2 : Math.min(navigator.hardwareConcurrency || 2, 4),
    maxCanvasPixels: 1920 * 1080,
    previewScale: 0.6
  });

  const juliaRenderer = new FractalRenderer({
    canvas: juliaCanvas,
    loadingIndicator: juliaLoading,
    workerUrl: '{{ site.baseurl }}/assets/js/julia-worker.js',
    type: 'julia',
    allowIterationData: false,
    maxWorkers: FractalUtils.isMobileDevice() ? 2 : Math.min(navigator.hardwareConcurrency || 2, 4),
    maxCanvasPixels: 1920 * 1080,
    previewScale: 0.6
  });

  function getMaxZoom() {
    return state.allowExtremeZoom ? MAX_ZOOM_EXTREME : MAX_ZOOM_DEFAULT;
  }

  function updateZoomWarnings() {
    if (mandelbrotZoomWarning) {
      mandelbrotZoomWarning.style.display = state.mandelbrot.zoomLevel >= ZOOM_WARNING_THRESHOLD ? 'block' : 'none';
    }
    if (explorerJuliaZoomWarning) {
      explorerJuliaZoomWarning.style.display = state.julia.zoomLevel >= ZOOM_WARNING_THRESHOLD ? 'block' : 'none';
    }
  }

  mandelbrotRenderer.onViewUpdate = (view) => {
    if (mandelbrotZoomLevel) mandelbrotZoomLevel.textContent = view.zoomLevel.toFixed(2) + '×';
    updateZoomWarnings();
  };
  juliaRenderer.onViewUpdate = (view) => {
    if (juliaZoomLevel) juliaZoomLevel.textContent = view.zoomLevel.toFixed(2) + '×';
    updateZoomWarnings();
  };

  function setButtonLabel(button, label) {
    if (!button) return;
    const text = button.querySelector('.btn-text');
    if (text) text.textContent = label;
  }

  function syncRendererState() {
    const palettes = state.useIntense ? FractalPalettes.intense : FractalPalettes.standard;
    if (!palettes[state.colorScheme]) {
      state.colorScheme = 'blau-rot';
      colorSchemeSelect.value = state.colorScheme;
    }
    mandelbrotRenderer.setState({
      viewX: state.mandelbrot.viewX,
      viewY: state.mandelbrot.viewY,
      zoomLevel: state.mandelbrot.zoomLevel,
      maxIterations: state.maxIterations,
      colorScheme: state.colorScheme,
      colorPalettes: palettes
    });
    juliaRenderer.setState({
      viewX: state.julia.viewX,
      viewY: state.julia.viewY,
      zoomLevel: state.julia.zoomLevel,
      maxIterations: state.maxIterations,
      colorScheme: state.colorScheme,
      colorPalettes: palettes,
      realPart: state.julia.realPart,
      imagPart: state.julia.imagPart
    });
  }

  function requestRender(renderer, options) {
    const settings = options || {};
    syncRendererState();
    if (settings.preview) renderer.drawPreview();
    if (settings.immediate) {
      renderer.render({ preview: false, reason: settings.reason || 'immediate' });
    } else {
      renderer.scheduleRender({ debounce: settings.debounce || 200, reason: settings.reason || 'scheduled' });
    }
  }

  function resizeAndRender() {
    mandelbrotRenderer.resizeToContainer(mandelbrotCanvas.parentElement);
    juliaRenderer.resizeToContainer(juliaCanvas.parentElement);
    requestRender(mandelbrotRenderer, { immediate: true, reason: 'resize' });
    requestRender(juliaRenderer, { immediate: true, reason: 'resize' });
  }

  function getCanvasCoords(canvas, event) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
      x: (event.clientX - rect.left) * scaleX,
      y: (event.clientY - rect.top) * scaleY
    };
  }

  function getCssCoords(canvas, event) {
    const rect = canvas.getBoundingClientRect();
    return {
      x: event.clientX - rect.left,
      y: event.clientY - rect.top
    };
  }

  function getTouchCanvasCoords(canvas, touch) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
      x: (touch.clientX - rect.left) * scaleX,
      y: (touch.clientY - rect.top) * scaleY
    };
  }

  function getTouchCenter(canvas, touches) {
    if (!touches || touches.length < 2) return null;
    const p1 = getTouchCanvasCoords(canvas, touches[0]);
    const p2 = getTouchCanvasCoords(canvas, touches[1]);
    return {
      x: (p1.x + p2.x) / 2,
      y: (p1.y + p2.y) / 2
    };
  }

  function getTouchDistance(touches) {
    if (!touches || touches.length < 2) return 0;
    const dx = touches[0].clientX - touches[1].clientX;
    const dy = touches[0].clientY - touches[1].clientY;
    return Math.hypot(dx, dy);
  }

  function getOrCreateZoomBox(canvas) {
    if (!canvas.__zoomBox) {
      const zoomBox = document.createElement('div');
      zoomBox.className = 'zoom-box';
      canvas.parentElement.appendChild(zoomBox);
      canvas.__zoomBox = zoomBox;
    }
    return canvas.__zoomBox;
  }

  function screenToComplex(stateView, canvas, pos) {
    const xRange = 3 / stateView.zoomLevel;
    const yRange = 3 / stateView.zoomLevel;
    return {
      cx: stateView.viewX - xRange / 2 + (pos.x / canvas.width) * xRange,
      cy: stateView.viewY - yRange / 2 + (pos.y / canvas.height) * yRange
    };
  }

  function animateZoomTo(stateView, renderer, targetZoom, center, canvas) {
    const xRangeNew = 3 / targetZoom;
    const yRangeNew = 3 / targetZoom;
    const complexAtCursor = screenToComplex(stateView, canvas, center);
    const targetViewX = complexAtCursor.cx - (center.x / canvas.width) * xRangeNew + xRangeNew / 2;
    const targetViewY = complexAtCursor.cy - (center.y / canvas.height) * yRangeNew + yRangeNew / 2;
    renderer.animateTo({ viewX: targetViewX, viewY: targetViewY, zoomLevel: targetZoom }, 140);
    stateView.viewX = targetViewX;
    stateView.viewY = targetViewY;
    stateView.zoomLevel = targetZoom;
  }

  function updateJuliaParameterText() {
    if (juliaParamSpan) {
      juliaParamSpan.textContent = `${state.julia.realPart.toFixed(3)} + ${state.julia.imagPart.toFixed(3)}i`;
    }
  }

  function applyMandelbrotTap(pos) {
    const complex = screenToComplex(state.mandelbrot, mandelbrotCanvas, pos);
    state.julia.realPart = complex.cx;
    state.julia.imagPart = complex.cy;
    updateJuliaParameterText();
    requestRender(juliaRenderer, { immediate: true, reason: 'julia-c' });
  }

  // noUiSlider Event Handler
  maxIterSliderElement.noUiSlider.on('update', function(values, handle) {
    const value = values[handle];
    state.maxIterations = parseInt(value, 10);
    iterValueSpan.textContent = value;
  });
  
  maxIterSliderElement.noUiSlider.on('change', function(values, handle) {
    requestRender(mandelbrotRenderer, { preview: true, debounce: 220, reason: 'iterations' });
    requestRender(juliaRenderer, { preview: true, debounce: 220, reason: 'iterations' });
  });

  colorSchemeSelect.addEventListener('change', function() {
    state.colorScheme = this.value;
    requestRender(mandelbrotRenderer, { preview: true, debounce: 200, reason: 'palette' });
    requestRender(juliaRenderer, { preview: true, debounce: 200, reason: 'palette' });
  });

  if (colorIntensityButton) {
    colorIntensityButton.addEventListener('click', function() {
      state.useIntense = !state.useIntense;
      this.classList.toggle('active', state.useIntense);
      setButtonLabel(colorIntensityButton, state.useIntense ? 'Intensiv' : 'Subtil');
      requestRender(mandelbrotRenderer, { preview: true, debounce: 200, reason: 'palette' });
      requestRender(juliaRenderer, { preview: true, debounce: 200, reason: 'palette' });
    });
  }

  if (allowExtremeZoomButton) {
    allowExtremeZoomButton.addEventListener('click', function() {
      state.allowExtremeZoom = !state.allowExtremeZoom;
      this.classList.toggle('active', state.allowExtremeZoom);
      setButtonLabel(allowExtremeZoomButton, state.allowExtremeZoom ? 'An' : 'Aus');
      if (!state.allowExtremeZoom) {
        const maxZoom = MAX_ZOOM_DEFAULT;
        if (state.mandelbrot.zoomLevel > maxZoom) {
          state.mandelbrot.zoomLevel = maxZoom;
          mandelbrotRenderer.animateTo({ viewX: state.mandelbrot.viewX, viewY: state.mandelbrot.viewY, zoomLevel: state.mandelbrot.zoomLevel }, 160);
        }
        if (state.julia.zoomLevel > maxZoom) {
          state.julia.zoomLevel = maxZoom;
          juliaRenderer.animateTo({ viewX: state.julia.viewX, viewY: state.julia.viewY, zoomLevel: state.julia.zoomLevel }, 160);
        }
        requestRender(mandelbrotRenderer, { immediate: true, reason: 'limit-clamp' });
        requestRender(juliaRenderer, { immediate: true, reason: 'limit-clamp' });
      }
      updateZoomWarnings();
    });
  }

  resetButton.addEventListener('click', function() {
    state.mandelbrot.viewX = -0.5;
    state.mandelbrot.viewY = 0;
    state.mandelbrot.zoomLevel = 1;
    state.julia.viewX = 0;
    state.julia.viewY = 0;
    state.julia.zoomLevel = 1;
    state.julia.realPart = -0.7;
    state.julia.imagPart = 0.27015;
    updateJuliaParameterText();
    mandelbrotRenderer.animateTo({ viewX: -0.5, viewY: 0, zoomLevel: 1 }, 180);
    juliaRenderer.animateTo({ viewX: 0, viewY: 0, zoomLevel: 1 }, 180);
    requestRender(mandelbrotRenderer, { immediate: true, reason: 'reset' });
    requestRender(juliaRenderer, { immediate: true, reason: 'reset' });
  });

  saveImageButton.addEventListener('click', function() {
    const link = document.createElement('a');
    link.download = 'mandelbrot-julia-explorer.png';
    const mergeCanvas = document.createElement('canvas');
    const width = Math.max(mandelbrotCanvas.width, juliaCanvas.width);
    const height = mandelbrotCanvas.height + juliaCanvas.height;
    mergeCanvas.width = width;
    mergeCanvas.height = height;
    const ctx = mergeCanvas.getContext('2d');
    ctx.drawImage(mandelbrotCanvas, 0, 0);
    ctx.drawImage(juliaCanvas, 0, mandelbrotCanvas.height);
    link.href = mergeCanvas.toDataURL('image/png');
    link.click();
  });

  // Toggle-Handler für Advanced und Focus Mode
  function setButtonLabel(button, text) {
    if (!button) return;
    const label = button.querySelector('.btn-text');
    if (label) {
      label.textContent = text;
    } else {
      button.textContent = text;
    }
  }

  if (advancedToggleButton) {
    advancedToggleButton.addEventListener('click', function() {
      container.classList.toggle('advanced-open');
      const isOpen = container.classList.contains('advanced-open');
      this.classList.toggle('active', isOpen);
      this.setAttribute('aria-expanded', isOpen);
      setButtonLabel(this, isOpen ? 'Optionen ausblenden' : 'Erweiterte Optionen');
      this.title = isOpen ? 'Erweiterte Optionen ausblenden' : 'Erweiterte Optionen anzeigen';
    });
  }

  if (focusModeButton) {
    focusModeButton.addEventListener('click', function() {
      container.classList.toggle('focus-mode');
      this.classList.toggle('active', container.classList.contains('focus-mode'));
      setTimeout(resizeAndRender, 80);
    });
  }

  if (fullscreenButton) {
    fullscreenButton.addEventListener('click', function() {
      if (!document.fullscreenElement) {
        container.requestFullscreen?.();
      } else {
        document.exitFullscreen?.();
      }
    });
    document.addEventListener('fullscreenchange', function() {
      const isFullscreen = !!document.fullscreenElement;
      container.classList.toggle('fullscreen-mode', isFullscreen);
      setButtonLabel(fullscreenButton, isFullscreen ? 'Vollbild aus' : 'Vollbild');
      setTimeout(resizeAndRender, 80);
    });
  }

  if (mandelbrotZoomIn) {
    mandelbrotZoomIn.addEventListener('click', function() {
      const targetZoom = FractalUtils.clamp(state.mandelbrot.zoomLevel * 1.2, MIN_ZOOM, getMaxZoom());
      animateZoomTo(state.mandelbrot, mandelbrotRenderer, targetZoom, { x: mandelbrotCanvas.width / 2, y: mandelbrotCanvas.height / 2 }, mandelbrotCanvas);
      requestRender(mandelbrotRenderer, { debounce: 200, reason: 'zoom-in' });
    });
  }
  if (mandelbrotZoomOut) {
    mandelbrotZoomOut.addEventListener('click', function() {
      const targetZoom = FractalUtils.clamp(state.mandelbrot.zoomLevel / 1.2, MIN_ZOOM, getMaxZoom());
      animateZoomTo(state.mandelbrot, mandelbrotRenderer, targetZoom, { x: mandelbrotCanvas.width / 2, y: mandelbrotCanvas.height / 2 }, mandelbrotCanvas);
      requestRender(mandelbrotRenderer, { debounce: 200, reason: 'zoom-out' });
    });
  }
  if (juliaZoomIn) {
    juliaZoomIn.addEventListener('click', function() {
      const targetZoom = FractalUtils.clamp(state.julia.zoomLevel * 1.2, MIN_ZOOM, getMaxZoom());
      animateZoomTo(state.julia, juliaRenderer, targetZoom, { x: juliaCanvas.width / 2, y: juliaCanvas.height / 2 }, juliaCanvas);
      requestRender(juliaRenderer, { debounce: 200, reason: 'zoom-in' });
    });
  }
  if (juliaZoomOut) {
    juliaZoomOut.addEventListener('click', function() {
      const targetZoom = FractalUtils.clamp(state.julia.zoomLevel / 1.2, MIN_ZOOM, getMaxZoom());
      animateZoomTo(state.julia, juliaRenderer, targetZoom, { x: juliaCanvas.width / 2, y: juliaCanvas.height / 2 }, juliaCanvas);
      requestRender(juliaRenderer, { debounce: 200, reason: 'zoom-out' });
    });
  }

  let mandelbrotPanning = false;
  let juliaPanning = false;
  let mandelbrotLast = null;
  let juliaLast = null;
  let mandelbrotZoomBoxStart = null;
  let mandelbrotZoomBoxStartCss = null;
  let juliaZoomBoxStart = null;
  let juliaZoomBoxStartCss = null;
  let mandelbrotPointerId = null;
  let juliaPointerId = null;
  let mandelbrotDidDrag = false;
  let mandelbrotClickTimer = null;
  let isSpacePanning = false;

  mandelbrotCanvas.addEventListener('pointerdown', function(event) {
    if (event.pointerType === 'touch') return;
    if (mandelbrotPointerId !== null) return;
    mandelbrotPointerId = event.pointerId;
    mandelbrotCanvas.setPointerCapture(event.pointerId);
    mandelbrotDidDrag = false;
    const canvasPos = getCanvasCoords(mandelbrotCanvas, event);
    const cssPos = getCssCoords(mandelbrotCanvas, event);
    if (event.button === 2 || isSpacePanning) {
      mandelbrotPanning = true;
      mandelbrotLast = canvasPos;
      return;
    }
    if (event.button !== 0) return;
    mandelbrotZoomBoxStart = canvasPos;
    mandelbrotZoomBoxStartCss = cssPos;
    const zoomBox = getOrCreateZoomBox(mandelbrotCanvas);
    zoomBox.style.display = 'block';
    zoomBox.style.left = cssPos.x + 'px';
    zoomBox.style.top = cssPos.y + 'px';
    zoomBox.style.width = '0px';
    zoomBox.style.height = '0px';
  });
  mandelbrotCanvas.addEventListener('pointermove', function(event) {
    if (mandelbrotPointerId !== event.pointerId) return;
    const canvasPos = getCanvasCoords(mandelbrotCanvas, event);
    const cssPos = getCssCoords(mandelbrotCanvas, event);
    if (mandelbrotZoomBoxStart && mandelbrotZoomBoxStartCss) {
      const zoomBox = getOrCreateZoomBox(mandelbrotCanvas);
      const left = Math.min(cssPos.x, mandelbrotZoomBoxStartCss.x);
      const top = Math.min(cssPos.y, mandelbrotZoomBoxStartCss.y);
      const width = Math.abs(cssPos.x - mandelbrotZoomBoxStartCss.x);
      const height = Math.abs(cssPos.y - mandelbrotZoomBoxStartCss.y);
      zoomBox.style.left = left + 'px';
      zoomBox.style.top = top + 'px';
      zoomBox.style.width = width + 'px';
      zoomBox.style.height = height + 'px';
      mandelbrotDidDrag = width > 2 || height > 2;
      return;
    }
    if (!mandelbrotPanning || !mandelbrotLast) return;
    const dx = canvasPos.x - mandelbrotLast.x;
    const dy = canvasPos.y - mandelbrotLast.y;
    if (Math.abs(dx) > 0.1 || Math.abs(dy) > 0.1) {
      mandelbrotDidDrag = true;
    }
    const xRange = 3 / state.mandelbrot.zoomLevel;
    const yRange = 3 / state.mandelbrot.zoomLevel;
    state.mandelbrot.viewX -= (dx / mandelbrotCanvas.width) * xRange;
    state.mandelbrot.viewY -= (dy / mandelbrotCanvas.height) * yRange;
    mandelbrotLast = canvasPos;
    mandelbrotRenderer.setState({
      viewX: state.mandelbrot.viewX,
      viewY: state.mandelbrot.viewY,
      zoomLevel: state.mandelbrot.zoomLevel
    });
    mandelbrotRenderer.drawPreview();
    mandelbrotRenderer.scheduleRender({ debounce: 180, reason: 'pan' });
  });
  mandelbrotCanvas.addEventListener('pointerup', function(event) {
    if (mandelbrotPointerId !== event.pointerId) return;
    const canvasPos = getCanvasCoords(mandelbrotCanvas, event);
    if (mandelbrotZoomBoxStart && mandelbrotZoomBoxStartCss) {
      const zoomBox = getOrCreateZoomBox(mandelbrotCanvas);
      zoomBox.style.display = 'none';
      const width = Math.abs(canvasPos.x - mandelbrotZoomBoxStart.x);
      const height = Math.abs(canvasPos.y - mandelbrotZoomBoxStart.y);
      if (width > 10 && height > 10) {
        const centerX = (canvasPos.x + mandelbrotZoomBoxStart.x) / 2;
        const centerY = (canvasPos.y + mandelbrotZoomBoxStart.y) / 2;
        const zoomX = mandelbrotCanvas.width / width;
        const zoomY = mandelbrotCanvas.height / height;
        const targetZoom = FractalUtils.clamp(state.mandelbrot.zoomLevel * Math.min(zoomX, zoomY), MIN_ZOOM, getMaxZoom());
        animateZoomTo(state.mandelbrot, mandelbrotRenderer, targetZoom, { x: centerX, y: centerY }, mandelbrotCanvas);
        requestRender(mandelbrotRenderer, { debounce: 180, reason: 'zoom-box' });
        mandelbrotDidDrag = true;
      }
    }
    mandelbrotZoomBoxStart = null;
    mandelbrotZoomBoxStartCss = null;
    mandelbrotPanning = false;
    mandelbrotLast = null;
    mandelbrotPointerId = null;
  });
  mandelbrotCanvas.addEventListener('pointercancel', function(event) {
    if (mandelbrotPointerId !== event.pointerId) return;
    mandelbrotPanning = false;
    mandelbrotLast = null;
    mandelbrotZoomBoxStart = null;
    mandelbrotZoomBoxStartCss = null;
    mandelbrotPointerId = null;
    const zoomBox = mandelbrotCanvas.__zoomBox;
    if (zoomBox) zoomBox.style.display = 'none';
  });

  juliaCanvas.addEventListener('pointerdown', function(event) {
    if (event.pointerType === 'touch') return;
    if (juliaPointerId !== null) return;
    juliaPointerId = event.pointerId;
    juliaCanvas.setPointerCapture(event.pointerId);
    const canvasPos = getCanvasCoords(juliaCanvas, event);
    const cssPos = getCssCoords(juliaCanvas, event);
    if (event.button === 2 || isSpacePanning) {
      juliaPanning = true;
      juliaLast = canvasPos;
      return;
    }
    if (event.button !== 0) return;
    juliaZoomBoxStart = canvasPos;
    juliaZoomBoxStartCss = cssPos;
    const zoomBox = getOrCreateZoomBox(juliaCanvas);
    zoomBox.style.display = 'block';
    zoomBox.style.left = cssPos.x + 'px';
    zoomBox.style.top = cssPos.y + 'px';
    zoomBox.style.width = '0px';
    zoomBox.style.height = '0px';
  });
  juliaCanvas.addEventListener('pointermove', function(event) {
    if (juliaPointerId !== event.pointerId) return;
    const canvasPos = getCanvasCoords(juliaCanvas, event);
    const cssPos = getCssCoords(juliaCanvas, event);
    if (juliaZoomBoxStart && juliaZoomBoxStartCss) {
      const zoomBox = getOrCreateZoomBox(juliaCanvas);
      const left = Math.min(cssPos.x, juliaZoomBoxStartCss.x);
      const top = Math.min(cssPos.y, juliaZoomBoxStartCss.y);
      const width = Math.abs(cssPos.x - juliaZoomBoxStartCss.x);
      const height = Math.abs(cssPos.y - juliaZoomBoxStartCss.y);
      zoomBox.style.left = left + 'px';
      zoomBox.style.top = top + 'px';
      zoomBox.style.width = width + 'px';
      zoomBox.style.height = height + 'px';
      return;
    }
    if (!juliaPanning || !juliaLast) return;
    const dx = canvasPos.x - juliaLast.x;
    const dy = canvasPos.y - juliaLast.y;
    const xRange = 3 / state.julia.zoomLevel;
    const yRange = 3 / state.julia.zoomLevel;
    state.julia.viewX -= (dx / juliaCanvas.width) * xRange;
    state.julia.viewY -= (dy / juliaCanvas.height) * yRange;
    juliaLast = canvasPos;
    juliaRenderer.setState({
      viewX: state.julia.viewX,
      viewY: state.julia.viewY,
      zoomLevel: state.julia.zoomLevel
    });
    juliaRenderer.drawPreview();
    juliaRenderer.scheduleRender({ debounce: 180, reason: 'pan' });
  });
  juliaCanvas.addEventListener('pointerup', function(event) {
    if (juliaPointerId !== event.pointerId) return;
    const canvasPos = getCanvasCoords(juliaCanvas, event);
    if (juliaZoomBoxStart && juliaZoomBoxStartCss) {
      const zoomBox = getOrCreateZoomBox(juliaCanvas);
      zoomBox.style.display = 'none';
      const width = Math.abs(canvasPos.x - juliaZoomBoxStart.x);
      const height = Math.abs(canvasPos.y - juliaZoomBoxStart.y);
      if (width > 10 && height > 10) {
        const centerX = (canvasPos.x + juliaZoomBoxStart.x) / 2;
        const centerY = (canvasPos.y + juliaZoomBoxStart.y) / 2;
        const zoomX = juliaCanvas.width / width;
        const zoomY = juliaCanvas.height / height;
        const targetZoom = FractalUtils.clamp(state.julia.zoomLevel * Math.min(zoomX, zoomY), MIN_ZOOM, getMaxZoom());
        animateZoomTo(state.julia, juliaRenderer, targetZoom, { x: centerX, y: centerY }, juliaCanvas);
        requestRender(juliaRenderer, { debounce: 180, reason: 'zoom-box' });
      }
    }
    juliaZoomBoxStart = null;
    juliaZoomBoxStartCss = null;
    juliaPanning = false;
    juliaLast = null;
    juliaPointerId = null;
  });
  juliaCanvas.addEventListener('pointercancel', function(event) {
    if (juliaPointerId !== event.pointerId) return;
    juliaPanning = false;
    juliaLast = null;
    juliaZoomBoxStart = null;
    juliaZoomBoxStartCss = null;
    juliaPointerId = null;
    const zoomBox = juliaCanvas.__zoomBox;
    if (zoomBox) zoomBox.style.display = 'none';
  });

  mandelbrotCanvas.addEventListener('contextmenu', function(event) {
    event.preventDefault();
  });

  juliaCanvas.addEventListener('contextmenu', function(event) {
    event.preventDefault();
  });

  window.addEventListener('keydown', function(event) {
    if (event.code === 'Space') {
      isSpacePanning = true;
    }
  });

  window.addEventListener('keyup', function(event) {
    if (event.code === 'Space') {
      isSpacePanning = false;
    }
  });

  mandelbrotCanvas.addEventListener('click', function(event) {
    if (mandelbrotDidDrag) {
      mandelbrotDidDrag = false;
      return;
    }
    if (mandelbrotClickTimer) {
      clearTimeout(mandelbrotClickTimer);
      mandelbrotClickTimer = null;
    }
    const clickEvent = event;
    mandelbrotClickTimer = setTimeout(() => {
      const pos = getCanvasCoords(mandelbrotCanvas, clickEvent);
      applyMandelbrotTap(pos);
      mandelbrotClickTimer = null;
    }, 220);
  });

  mandelbrotCanvas.addEventListener('wheel', function(event) {
    event.preventDefault();
    const pos = getCanvasCoords(mandelbrotCanvas, event);
    const zoomFactor = Math.exp(-event.deltaY * 0.0016);
    const targetZoom = FractalUtils.clamp(state.mandelbrot.zoomLevel * zoomFactor, MIN_ZOOM, getMaxZoom());
    animateZoomTo(state.mandelbrot, mandelbrotRenderer, targetZoom, pos, mandelbrotCanvas);
    requestRender(mandelbrotRenderer, { debounce: 220, reason: 'wheel' });
  }, { passive: false });

  mandelbrotCanvas.addEventListener('dblclick', function(event) {
    event.preventDefault();
    if (mandelbrotClickTimer) {
      clearTimeout(mandelbrotClickTimer);
      mandelbrotClickTimer = null;
    }
    const pos = getCanvasCoords(mandelbrotCanvas, event);
    const targetZoom = FractalUtils.clamp(state.mandelbrot.zoomLevel / 2, MIN_ZOOM, getMaxZoom());
    animateZoomTo(state.mandelbrot, mandelbrotRenderer, targetZoom, pos, mandelbrotCanvas);
    requestRender(mandelbrotRenderer, { debounce: 180, reason: 'dblclick-out' });
  });

  juliaCanvas.addEventListener('wheel', function(event) {
    event.preventDefault();
    const pos = getCanvasCoords(juliaCanvas, event);
    const zoomFactor = Math.exp(-event.deltaY * 0.0016);
    const targetZoom = FractalUtils.clamp(state.julia.zoomLevel * zoomFactor, MIN_ZOOM, getMaxZoom());
    animateZoomTo(state.julia, juliaRenderer, targetZoom, pos, juliaCanvas);
    requestRender(juliaRenderer, { debounce: 220, reason: 'wheel' });
  }, { passive: false });

  juliaCanvas.addEventListener('dblclick', function(event) {
    event.preventDefault();
    const pos = getCanvasCoords(juliaCanvas, event);
    const targetZoom = FractalUtils.clamp(state.julia.zoomLevel / 2, MIN_ZOOM, getMaxZoom());
    animateZoomTo(state.julia, juliaRenderer, targetZoom, pos, juliaCanvas);
    requestRender(juliaRenderer, { debounce: 180, reason: 'dblclick-out' });
  });

  let mandelbrotTouchPanning = false;
  let mandelbrotTouchLast = null;
  let mandelbrotTouchMoved = false;
  let mandelbrotTouchTapStart = null;
  const mandelbrotPinch = { active: false, startDist: 0, startZoom: 1 };

  mandelbrotCanvas.addEventListener('touchstart', function(event) {
    event.preventDefault();
    if (event.touches.length === 2) {
      mandelbrotPinch.active = true;
      mandelbrotPinch.startDist = getTouchDistance(event.touches);
      mandelbrotPinch.startZoom = state.mandelbrot.zoomLevel;
      mandelbrotTouchPanning = false;
      mandelbrotTouchMoved = true;
      return;
    }
    if (event.touches.length === 1) {
      mandelbrotTouchPanning = true;
      mandelbrotTouchMoved = false;
      mandelbrotTouchLast = getTouchCanvasCoords(mandelbrotCanvas, event.touches[0]);
      mandelbrotTouchTapStart = { time: performance.now(), pos: mandelbrotTouchLast };
    }
  }, { passive: false });

  mandelbrotCanvas.addEventListener('touchmove', function(event) {
    event.preventDefault();
    if (mandelbrotPinch.active && event.touches.length === 2) {
      const distance = getTouchDistance(event.touches);
      if (!mandelbrotPinch.startDist) mandelbrotPinch.startDist = distance;
      const zoomFactor = distance / mandelbrotPinch.startDist;
      const targetZoom = FractalUtils.clamp(mandelbrotPinch.startZoom * zoomFactor, MIN_ZOOM, getMaxZoom());
      const center = getTouchCenter(mandelbrotCanvas, event.touches);
      if (center) {
        animateZoomTo(state.mandelbrot, mandelbrotRenderer, targetZoom, center, mandelbrotCanvas);
        requestRender(mandelbrotRenderer, { debounce: 120, reason: 'pinch' });
      }
      return;
    }
    if (!mandelbrotTouchPanning || event.touches.length !== 1 || !mandelbrotTouchLast) return;
    const newPos = getTouchCanvasCoords(mandelbrotCanvas, event.touches[0]);
    const dx = newPos.x - mandelbrotTouchLast.x;
    const dy = newPos.y - mandelbrotTouchLast.y;
    if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
      mandelbrotTouchMoved = true;
    }
    const xRange = 3 / state.mandelbrot.zoomLevel;
    const yRange = 3 / state.mandelbrot.zoomLevel;
    state.mandelbrot.viewX -= (dx / mandelbrotCanvas.width) * xRange;
    state.mandelbrot.viewY -= (dy / mandelbrotCanvas.height) * yRange;
    mandelbrotTouchLast = newPos;
    mandelbrotRenderer.setState({
      viewX: state.mandelbrot.viewX,
      viewY: state.mandelbrot.viewY,
      zoomLevel: state.mandelbrot.zoomLevel
    });
    mandelbrotRenderer.drawPreview();
    mandelbrotRenderer.scheduleRender({ debounce: 160, reason: 'pan-touch' });
  }, { passive: false });

  mandelbrotCanvas.addEventListener('touchend', function(event) {
    event.preventDefault();
    if (mandelbrotPinch.active && event.touches.length < 2) {
      mandelbrotPinch.active = false;
      mandelbrotPinch.startDist = 0;
      mandelbrotPinch.startZoom = state.mandelbrot.zoomLevel;
    }
    if (event.touches.length === 0 && mandelbrotTouchPanning) {
      if (!mandelbrotTouchMoved && mandelbrotTouchTapStart) {
        const tapAge = performance.now() - mandelbrotTouchTapStart.time;
        if (tapAge < 300) {
          applyMandelbrotTap(mandelbrotTouchTapStart.pos);
        }
      }
      mandelbrotTouchPanning = false;
      mandelbrotTouchLast = null;
      mandelbrotTouchTapStart = null;
    }
  }, { passive: false });

  let juliaTouchPanning = false;
  let juliaTouchLast = null;
  const juliaPinch = { active: false, startDist: 0, startZoom: 1 };

  juliaCanvas.addEventListener('touchstart', function(event) {
    event.preventDefault();
    if (event.touches.length === 2) {
      juliaPinch.active = true;
      juliaPinch.startDist = getTouchDistance(event.touches);
      juliaPinch.startZoom = state.julia.zoomLevel;
      juliaTouchPanning = false;
      return;
    }
    if (event.touches.length === 1) {
      juliaTouchPanning = true;
      juliaTouchLast = getTouchCanvasCoords(juliaCanvas, event.touches[0]);
    }
  }, { passive: false });

  juliaCanvas.addEventListener('touchmove', function(event) {
    event.preventDefault();
    if (juliaPinch.active && event.touches.length === 2) {
      const distance = getTouchDistance(event.touches);
      if (!juliaPinch.startDist) juliaPinch.startDist = distance;
      const zoomFactor = distance / juliaPinch.startDist;
      const targetZoom = FractalUtils.clamp(juliaPinch.startZoom * zoomFactor, MIN_ZOOM, getMaxZoom());
      const center = getTouchCenter(juliaCanvas, event.touches);
      if (center) {
        animateZoomTo(state.julia, juliaRenderer, targetZoom, center, juliaCanvas);
        requestRender(juliaRenderer, { debounce: 120, reason: 'pinch' });
      }
      return;
    }
    if (!juliaTouchPanning || event.touches.length !== 1 || !juliaTouchLast) return;
    const newPos = getTouchCanvasCoords(juliaCanvas, event.touches[0]);
    const dx = newPos.x - juliaTouchLast.x;
    const dy = newPos.y - juliaTouchLast.y;
    const xRange = 3 / state.julia.zoomLevel;
    const yRange = 3 / state.julia.zoomLevel;
    state.julia.viewX -= (dx / juliaCanvas.width) * xRange;
    state.julia.viewY -= (dy / juliaCanvas.height) * yRange;
    juliaTouchLast = newPos;
    juliaRenderer.setState({
      viewX: state.julia.viewX,
      viewY: state.julia.viewY,
      zoomLevel: state.julia.zoomLevel
    });
    juliaRenderer.drawPreview();
    juliaRenderer.scheduleRender({ debounce: 160, reason: 'pan-touch' });
  }, { passive: false });

  juliaCanvas.addEventListener('touchend', function(event) {
    event.preventDefault();
    if (juliaPinch.active && event.touches.length < 2) {
      juliaPinch.active = false;
      juliaPinch.startDist = 0;
      juliaPinch.startZoom = state.julia.zoomLevel;
    }
    if (event.touches.length === 0) {
      juliaTouchPanning = false;
      juliaTouchLast = null;
    }
  }, { passive: false });

  function updateMobileControls() {
    const isMobile = FractalUtils.isMobileDevice() || window.innerWidth <= 768;
    if (mandelbrotMobileZoom) mandelbrotMobileZoom.style.display = isMobile ? 'flex' : 'none';
    if (juliaMobileZoom) juliaMobileZoom.style.display = isMobile ? 'flex' : 'none';
  }

  window.addEventListener('resize', function() {
    updateMobileControls();
    resizeAndRender();
  });

  if (typeof ResizeObserver !== 'undefined') {
    const resizeObserver = new ResizeObserver(() => resizeAndRender());
    resizeObserver.observe(mandelbrotCanvas.parentElement);
    resizeObserver.observe(juliaCanvas.parentElement);
  }

  // Initial value is already set by noUiSlider
  if (allowExtremeZoomButton) {
    setButtonLabel(allowExtremeZoomButton, state.allowExtremeZoom ? 'An' : 'Aus');
  }
  updateJuliaParameterText();
  updateZoomWarnings();
  updateMobileControls();
  resizeAndRender();
});
</script>
